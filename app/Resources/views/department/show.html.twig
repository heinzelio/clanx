{% extends 'base_nav.html.twig' %}

{% block title %}
Ressort: {{ department.name }}
{% endblock %}

{% block workspace %}
<div class="row">
<div class="col-md-6">
<div class="panel panel-primary">
    <div class="panel-heading">
        Ressort <strong>{{ department.name }}</strong> vom Event {{ event.name }}
        {% if is_granted('ROLE_SUPER_ADMIN')%}
        ID: {{ department.id }}
        {% endif %}
        {% if department.locked %}
            <br/>Dieses Ressort ist gesperrt. Einschreiben nicht mehr möglich.
            <span class="glyphicon glyphicon-lock"></span>
        {% endif %}
    </div>
    <div class="panel-body">
        {% if department.requirement %}
            <p><strong>Anforderung</strong></p>
            <p>{{department.requirement}}</p>
        {% endif %}
        <p><strong>
            {{commitments|length}}
            {% if commitments|length ==1 %}
                eingeschreibener
            {% else %}
                eingeschreibene
            {% endif %}
             Hölfer im Ressort:
        </strong></p>
        {% for cmt in commitments %}
            {% set vol = cmt.user %}
            <p>
                {{ vol }} {# this calls User.__toString(). Pretty neat. #}
                {% if is_granted('ROLE_ADMIN') %}
                    <a class="btn btn-default"
                        href="{{ path('department_redirect_mail_to',{
                                'id':department.id,
                                'user_id':vol.id})}}"
                        data-toggle="tooltip"
                        title="{{vol}} ein Email schreiben.">
                        <span class="glyphicon glyphicon-envelope"></span>
                    </a>
                {% endif %}

                {% if userIsChief or userIsDeputy or is_granted('ROLE_ADMIN') %}
                    <a class="btn btn-default"
                        href="{{path('department_move_volunteer',{'id':department.id,'user_id':vol.id})}}"
                        data-toggle="tooltip"
                        title="{{vol}} einem anderen Ressort zuweisen.">
                        <span class="glyphicon glyphicon-new-window"></span>
                        Verschieben
                    </a>
                    <a class="btn btn-default"
                        data-toggle="tooltip"
                        title="{{cmt.possibleStart}}">
                        <span class="glyphicon glyphicon-calendar"></span>
                    </a>
                    {% if cmt.remark %}
                        <a class="btn btn-default"
                            data-toggle="tooltip"
                            title="{{cmt.remark}}">
                            <span class="glyphicon glyphicon-comment"></span>
                        </a>
                    {% endif %}
                {% endif %}
        {% endfor %}
    </div>
    <div class="panel-footer">

        {% if is_granted('ROLE_ADMIN') %}

            <a class="btn btn-primary" type="button"
                href="{{ path('department_edit', { 'id': department.id ,'event_id':event.id}) }}"
                data-toggle="tooltip"
                title="Bearbeite alle Eigenschaften des Ressorts {{department.name}}.">
                <span class="glyphicon glyphicon-pencil"></span>
                Bearbeiten</a>

        {% else %}
            {% if userIsChief %}

                <a class="btn btn-default"
                    href="{{ path('department_edit_light',{'id':department.id}) }}"
                    data-toggle="tooltip"
                    title="Bearbeite Anforderung, Stellvertreter des Ressorts
                        {{department.name}} oder sperre es."
                    >
                    <span class="glyphicon glyphicon-pencil"></span>
                    Bearbeiten
                </a>

            {% endif %}
        {% endif %}

        {% if userIsChief or userIsDeputy or is_granted('ROLE_ADMIN') %}
            <a class="btn btn-default"
                href="{{ path('department_mail_volunteers', {
                'id':department.id
                }) }}"
                data-toggle="tooltip"
                title="Schreibe ein Email an alle Hölfer aus diesem Ressort."
                >
                <span class="glyphicon glyphicon-envelope"></span>
                Email
            </a>

            <a class="btn btn-default"
                href="{{ path('department_print_all', {'id': department.id}) }}"
                data-toggle="tooltip"
                title="Drucke von diesem Ressort alle Hölfer mit allen Daten."
                target="_blank"
                >
                <span class="glyphicon glyphicon-print"></span>
                Drucken
            </a>
        {% endif %}
        <a class="btn btn-default" type="button"
            href="{{ path('event_show',{'id':event.id}) }}"
            data-toggle="tooltip"
            title="Schliessen und zurück zur Ansicht gehen."
            >
            <span class="glyphicon glyphicon-remove"></span>
            Zurück</a>
        {% if mayDelete %}
            {{ form_start(delete_form) }}
                <input class="btn btn-danger" type="submit" value="Löschen"></input>
            {{ form_end(delete_form) }}
        {% endif %}
    </div><!-- footer -->
</div><!-- panel -->
</div><!-- col -->
</div><!-- row -->
{% endblock %}

{% block javascripts %}
<script>
    $(document).ready(function(){
        $('[data-toggle="tooltip"]').tooltip();
    });
</script>
{% endblock %}
